# 이동평균선 투자법 전략 정리

> 본 문서는 "이동평균선 투자법" 책의 핵심 내용을 정리하고, 자동 매매 시스템 구축을 위한 전략을 체계화한 문서입니다.

---

## 목차
1. [이동평균선에 대한 이해](#1-이동평균선에-대한-이해)
2. [이동평균선의 대순환 분석 및 대응법](#2-이동평균선의-대순환-분석-및-대응법)
3. [MACD에 대한 이해](#3-macd에-대한-이해)
4. [MACD 대순환 분석 및 대응법](#4-macd-대순환-분석-및-대응법)
5. [자금 관리와 리스크 관리](#5-자금-관리와-리스크-관리)

---

## 1. 이동평균선에 대한 이해

### 1.1 이동평균선의 기본 개념

**SMA (Simple Moving Average, 단순 이동평균선)**
- n일 동안의 가격을 합산하여 n으로 나눈 값
- 가격 변동을 매끄럽게(smoothing) 표현하여 추세를 파악하기 용이
- 계산식: SMA = (P₁ + P₂ + ... + Pₙ) / n
- 과거 일정 기간의 평균 가격을 연결한 선으로, 현재 가격이 평균 대비 고평가/저평가 여부 판단 가능

### 1.2 이동평균선의 종류와 특징

**주요 이동평균선 기간**

| 기간 | 명칭 | 특징 |
|------|------|------|
| **5일선** | 단기선 | 가격 변동에 민감하게 반응, 단기 추세 파악 |
| **20일선** | 중기선 | 중기 추세 판단, 단기선보다 안정적 신호 |
| **75일선** | 장기선 | 장기 추세 확인, 지지/저항선 역할 |

**기타 활용 이동평균선**
- **60일선**: 중장기 추세 전환 포인트 확인
- **120일선**: 반기 추세, 강력한 지지/저항선
- **200일선**: 연간 추세, 주요 심리적 지지/저항선

### 1.3 이동평균선의 활용법

**골든 크로스 & 데드 크로스**
- **골든 크로스**: 가격(또는 단기선)이 이동평균선을 아래에서 위로 돌파 → 매수 신호
- **데드 크로스**: 가격(또는 단기선)이 이동평균선을 위에서 아래로 돌파 → 매도 신호

**그랜빌의 법칙 - 4가지 매수 신호**

**매수 신호 ①: 전형적 골든 크로스 (최대 매수 기회)**
- 하락하던 이동평균선이 하락을 멈추거나 상승 전환
- 가격이 이동평균선을 아래에서 위로 돌파
- 추세 전환의 명확한 신호

**매수 신호 ②: 일시적 조정 후 재상승**
- 이동평균선은 상승 중
- 가격이 일시적으로 하락하여 이동평균선 아래로 내려감 (가짜 데드크로스)
- 이후 다시 골든크로스 형성하며 상승 재개
- 상승 추세 중 단기 조정 후 재진입 기회

**매수 신호 ③: 상승 추세 중 조정**
- 가격과 이동평균선 모두 상승 중
- 가격이 이동평균선에 근접하거나 소폭 하락
- 이동평균선을 지지선 삼아 반등 (추격 매수 기회)

**매수 신호 ④: 이동평균 괴리율 활용**
- 이동평균선은 하락 추세
- 가격이 이동평균선 대비 과도하게 하락 (과매도)
- 가격이 평균으로 회귀하려는 성질 이용한 단기 반등 매수
- 역추세 매매이므로 단기 대응 필수

**그랜빌의 법칙 - 4가지 매도 신호**

**매도 신호 ①: 전형적 데드 크로스 (최대 매도 기회)**
- 상승하던 이동평균선이 상승을 멈추거나 하락 전환 조짐
- 가격이 이동평균선을 위에서 아래로 돌파
- 추세 전환의 명확한 신호, 손실 최소화를 위한 청산 시점

**매도 신호 ②: 일시적 반등 후 재하락**
- 이동평균선은 하락 중
- 가격이 일시적으로 반등하여 이동평균선 위로 돌파 (가짜 골든크로스)
- 이후 다시 데드크로스 형성하며 하락 재개
- 하락 추세 중 단기 반등은 매도 기회

**매도 신호 ③: 하락 추세 중 반등 실패**
- 가격과 이동평균선 모두 하락 중
- 가격이 이동평균선에 근접하거나 소폭 반등
- 이동평균선을 저항선 삼아 재차 하락 (추격 매도 기회)

**매도 신호 ④: 이동평균 괴리율 활용 (과매수)**
- 이동평균선은 상승 추세
- 가격이 이동평균선 대비 과도하게 급등 (과매수)
- 급등 후 급락하며 가격 천장 형성 가능
- 큰 차익 실현은 어려우나 추가 손실 방지를 위한 청산

**실전 활용 포인트**
- 신호 ①과 ④가 가장 강력한 매수/매도 신호 (추세 전환 시점)
- 신호 ②와 ③은 기존 추세 내 조정 시점 활용
- 매수/매도 신호는 대칭적 구조로 이해
- 거래량 증가와 함께 나타날 때 신뢰도 상승

---

## 2. 이동평균선의 대순환 분석 및 대응법

### 2.1 대순환 분석의 개념

**3개 이동평균선을 활용한 시장 국면 분석**
- **사용 이동평균선**: 5일선(단기), 20일선(중기), 75일선(장기)
- **목적**: 3개 이동평균선의 배열 상태로 현재 시장이 어떤 국면에 있는지 파악
- 가격 추세와 이동평균선의 교차 패턴을 통해 추세 전환 시점을 포착

**추세 전환 신호 예시**

**상승 → 하락 전환**
- 배열: 위에서부터 단기 > 중기 > 장기 (우상향 정배열)
- 신호: 단기선이 중기선을 위에서 아래로 데드크로스
- 의미: 상승 국면이 하락 추세로 전환

**하락 → 상승 전환**
- 배열: 위에서부터 장기 > 중기 > 단기 (우하향 역배열)
- 신호: 단기선이 중기선을 아래에서 위로 골든크로스
- 의미: 하락 국면이 상승 추세로 전환

> 대순환 분석은 단순 크로스가 아닌, 3개 이동평균선의 전체적인 배열 변화를 통해 시장 국면을 입체적으로 파악하는 기법

### 2.2 대순환 단계별 특징

**6개 스테이지 구조** (3개 이동평균선의 위치 조합)

| 스테이지 | 배열 (위→아래) | 시장 국면 | 주요 특징 |
|---------|--------------|----------|----------|
| **제1스테이지** | 단기 > 중기 > 장기 | ①안정 상승기 | 완전한 정배열, 강한 상승 추세 |
| **제2스테이지** | 중기 > 단기 > 장기 | ②하락 변화기1 | 상승장의 종언, 데드크로스1 발생 |
| **제3스테이지** | 중기 > 장기 > 단기 | ③하락 변화기2 | 하락장의 암구(입구), 데드크로스2 발생 |
| **제4스테이지** | 장기 > 중기 > 단기 | ④안정 하락기 | 완전한 역배열, 강한 하락 추세 |
| **제5스테이지** | 장기 > 단기 > 중기 | ⑤상승 변화기1 | 하락장의 종언, 골든크로스1 발생 |
| **제6스테이지** | 단기 > 장기 > 중기 | ⑥상승 변화기2 | 상승장의 입구, 골든크로스2 발생 |

**대순환의 순환 구조**
```
제1스테이지(안정 상승) 
    ↓ 데드크로스1
제2스테이지(하락 변화1) 
    ↓ 데드크로스2
제3스테이지(하락 변화2) 
    ↓ 데드크로스3
제4스테이지(안정 하락) 
    ↓ 골든크로스1
제5스테이지(상승 변화1) 
    ↓ 골든크로스2
제6스테이지(상승 변화2) 
    ↓ 골든크로스3
제1스테이지로 회귀 (순환)
```

**핵심 포인트**
- 가격은 일반적으로 제1스테이지부터 순환 시작
- 각 스테이지는 순차적으로 진행되는 경향
- 스테이지 전환 시점(크로스 발생)이 매매 타이밍의 핵심
- 제1/4스테이지는 안정기(추세 명확), 제2·3·5·6스테이지는 변화기(추세 전환)

### 2.3 단계별 매매 전략

**분석 3요소**
1. **이동평균선 배열 순서**: 단기-중기-장기의 상하 위치
2. **이동평균선 간격**: 각 선 사이의 거리 변화 (확대/축소)
3. **이동평균선 기울기**: 각 선의 방향 (상승/평행/하락)

---

**제1스테이지: 안정 상승기 (공격적 매수)**
- **배열**: 단기 > 중기 > 장기 (완전 정배열)
- **기울기**: 3개선 모두 우상향
- **간격**: 이동평균선 사이 간격 확대
- **전략**: 공격적인 매수 진행
- **다음**: 제2스테이지로 전환

---

**제2스테이지: 하락 변화기1 (포지션 유지 판단)**
- **배열**: 중기 > 단기 > 장기
- **크로스**: 단기선이 중기선을 위→아래 데드크로스1
- **판단 기준**:
  - 중기-장기선 간격이 줄어들지 않거나
  - 장기선 기울기가 여전히 상승
  → **매수 포지션 유지**
- **의미**: 상승장의 종언 시작, 관망 필요

---

**제3스테이지: 하락 변화기2 (매수 청산 & 매도 준비)**
- **배열**: 중기 > 장기 > 단기
- **크로스**: 단기선이 장기선을 위→아래 데드크로스2
- **전략**:
  - **즉시**: 매수 포지션 청산
  - **매도 포지션 조기 주문 검토 조건**:
    - 단기선과 중기선이 우하향
    - 장기선이 평행에 가까움
- **다음**: 장기선 상승 멈추면 → 제4스테이지

---

**제4스테이지: 안정 하락기 (공격적 매도)**
- **배열**: 장기 > 중기 > 단기 (완전 역배열)
- **기울기**: 3개선 모두 우하향
- **간격**: 이동평균선 사이 간격 확대
- **전략**: 공격적인 매도 진행
- **다음**: 제5스테이지로 전환

---

**제5스테이지: 상승 변화기1 (포지션 유지 판단)**
- **배열**: 장기 > 단기 > 중기
- **크로스**: 단기선이 중기선을 아래→위 골든크로스1
- **판단 기준**:
  - 중기-장기선 간격이 줄어들지 않거나
  - 장기선 기울기가 여전히 하락
  → **매도 포지션 유지**
- **의미**: 하락장의 종언 시작, 관망 필요

---

**제6스테이지: 상승 변화기2 (매도 청산 & 매수 준비)**
- **배열**: 단기 > 장기 > 중기
- **크로스**: 단기선이 장기선을 아래→위 골든크로스2
- **전략**:
  - **즉시**: 매도 포지션 청산
  - **매수 포지션 조기 주문 검토 조건**:
    - 단기선과 중기선이 우상향
    - 장기선이 평행에 가까움
- **다음**: 장기선 하락 멈추면 → 제1스테이지

---

**매매 전략 핵심 요약**

| 국면 | 스테이지 | 주요 액션 | 핵심 판단 기준 |
|------|---------|---------|-------------|
| **강세장** | 제1 | 공격적 매수 | 정배열 + 간격확대 + 우상향 |
| **약세 전환** | 제2 | 포지션 유지 | 장기선 상승 + 중기-장기 간격 유지 |
| **약세 확정** | 제3 | 매수 청산, 매도 진입 | 데드크로스2 + 장기선 평행화 |
| **약세장** | 제4 | 공격적 매도 | 역배열 + 간격확대 + 우하향 |
| **강세 전환** | 제5 | 포지션 유지 | 장기선 하락 + 중기-장기 간격 유지 |
| **강세 확정** | 제6 | 매도 청산, 매수 진입 | 골든크로스2 + 장기선 평행화 |

---

### 2.4 실전 패턴 읽기

**눌림목 (Pullback) - 상승 추세 내 매수 기회**
- **현상**: 단기선 또는 가격이 일시적으로 하락
- **핵심**: 중기선이나 장기선은 여전히 상승 중
- **의미**: 상승 추세 내 건강한 조정
- **전략**: 추가 매수 기회 활용
- **확인**: 중장기선이 지지선 역할 수행하는지 확인

**일시적 반등 (Dead Cat Bounce) - 하락 추세 내 매도 기회**
- **현상**: 단기선 또는 가격이 일시적으로 상승
- **핵심**: 중기선이나 장기선은 여전히 하락 중
- **의미**: 하락 추세 내 약한 되돌림
- **전략**: 추가 매도 또는 공매도 청산 기회
- **주의**: 추세 전환 신호로 오인하지 않도록 주의

**박스권 (Consolidation) - 추세 전환 준비 구간**
- **현상**: 단기선, 가격, 중기선, 장기선이 가까워지며 횡보
- **특징**: 3개선의 간격이 좋아지고 방향성 상실
- **탈출 신호**: 3개선의 간격이 다시 벌어지기 시작
- **의미**: 에너지 축적 구간, 큰 움직임 전조
- **전략**:
  - 박스권 내: 모든 포지션 축소 또는 관망
  - 탈출 후: 탈출 방향에 따른 포지션 진입
- **주의**: 가짜 탈출 가능성, 거래량 병행 확인

**중기-장기선의 '띠' 읽기 - 추세 강도 파악**
- **정의**: 시간 순서에 따라 중기선과 장기선 사이의 간격을 넓이로 표현
- **전환 패턴**:
  - **음전**: 상승띠 → 하락띠 (약세 전환)
  - **양전**: 하락띠 → 상승띠 (강세 전환)

**띠으로 파악하는 요소**
1. **추세 방향성**: 띠의 기울기로 현재 추세 확인
2. **추세 강력함**: 띠의 폭이 넓을수록 강력한 추세
3. **안정성**: 띠의 일관성으로 추세 지속력 판단
4. **지지/저항 역할**: 띠 자체가 가격의 지지/저항대 기능

**띠 기반 매매 전략**

| 띠의 상태 | 폭 | 방향 | 매매 전략 |
|------------|-----|------|----------|
| **상승띠** | 넓음 | 상승 | 매수 기회 (강력한 상승) |
| **상승띠** | 좋음 | 상승 | 관망 또는 소극적 매수 |
| **하락띠** | 넓음 | 하락 | 매도 기회 (강력한 하락) |
| **하락띠** | 좋음 | 하락 | 관망 또는 소극적 매도 |
| **평행띠** | 좋음 | 평행 | 관망 권장 (박스권 가능성) |

**실전 포인트**
- 띠의 폭이 좋을 때는 모든 포지션을 취하지 않는 편이 무난
- 띠의 폭이 확대되는 구간이 추세 가속 신호
- 띠의 폭이 축소되는 구간이 추세 약화 신호
- 띠이 사라지고 세 선이 수렴하면 박스권 진입 가능성

---

### 2.5 대순환 분석의 장점과 주의점

**장점**

1. **명확한 추세 파악**
   - 3개 이동평균선의 배열로 현재 시장 국면을 한눈에 파악
   - 6개 스테이지로 시장 상황을 구조화하여 이해 용이

2. **최적의 매매 타이밍 포착**
   - **제1스테이지 진입**: 상승 확정 시점, 놓치지 말아야 할 매수 기회
   - **제4스테이지 진입**: 하락 확정 시점, 놓치지 말아야 할 매도 기회
   - 명확한 진입/청산 시점 제공으로 감정적 판단 최소화

3. **체계적인 위험 관리**
   - 스테이지별 대응 전략으로 포지션 관리 용이
   - 추세 전환 시점을 조기에 감지하여 손실 최소화

4. **추세 추종의 효율성**
   - 안정기(제1/4스테이지)에서 공격적 진입으로 큰 수익 추구
   - 변화기에서 신중한 대응으로 불필요한 손실 회피

---

**주의점**

1. **적합하지 않은 종목**
   - **가격변동이 적은 종목**: 박스권에 갇힌 종목, 거래량 부족 종목
   - 횡보장이 지속되는 종목에서는 신호의 신뢰도 하락
   - 추세가 명확한 종목 선택이 중요

2. **안정기 진입 시점 중요성**
   - 제1스테이지(상승 확정) 또는 제4스테이지(하락 확정) 진입 시점을 놓치지 말 것
   - 이 시기가 가장 큰 수익을 낼 수 있는 구간
   - 망설임 없이 포지션 진입 필요

3. **이행기에서의 신중함**
   - **제2·3·5·6스테이지**: 추세 전환 과정, 불확실성 높음
   - 이행기에서 무리한 포지션 확대 금지
   - 관망 또는 기존 포지션 유지/축소가 바람직
   - 명확한 신호 확인 후 행동

4. **보조 지표 병행 필요**
   - 거래량, RSI, MACD 등 보조 지표로 신호 확인
   - 단일 지표 의존의 위험성 인식
   - 다중 확인을 통한 신뢰도 향상

**실전 적용 원칙**
- ✅ **DO**: 제1/4스테이지 진입 시 적극적 대응
- ✅ **DO**: 추세가 명확한 종목 선택
- ✅ **DO**: 스테이지 전환 시점 면밀히 관찰
- ❌ **DON'T**: 이행기에서 무리한 포지션 확대
- ❌ **DON'T**: 횡보 종목에 대순환 분석 적용
- ❌ **DON'T**: 단일 신호만으로 매매 결정

---

## 3. MACD에 대한 이해

### 3.1 MACD의 기본 개념

**MACD (Moving Average Convergence Divergence)**
- **정의**: 이동평균의 수렴 및 확산 (Moving Average Convergence Divergence)
- **원리**: 기간이 다른 두 이동평균선의 차이를 수치화
- **계산식**: MACD = 단기 이동평균 - 장기 이동평균

**표준 설정 (제럴드 아펜의 최적화)**
```
MACD = 12일 EMA - 26일 EMA
```
- **12일 EMA**: 단기 추세
- **26일 EMA**: 장기 추세
- 이 조합이 추세 변화를 가장 효과적으로 포착

**MACD 값의 의미**

| MACD 값 | 의미 | 해석 |
|-----------|------|------|
| **0** | 교차 지점 | 단기선과 장기선이 만나는 지점 (골든/데드 크로스) |
| **양수 & 증가** | 상승 가속 | 단기선 > 장기선, 그 폭이 널어짐 (강세) |
| **양수 & 감소** | 상승 둔화 | 단기선 > 장기선, 그 폭이 좋아짐 (약세) |
| **음수 & 감소** | 하락 가속 | 단기선 < 장기선, 그 폭이 널어짐 (약세) |
| **음수 & 증가** | 하락 둔화 | 단기선 < 장기선, 그 폭이 좋아짐 (강세) |

### 3.2 MACD의 구성 요소

**1. EMA (Exponential Moving Average, 지수 이동평균)**

- **특징**: 최근 가격에 더 높은 비중 부여
- **SMA와의 차이**: SMA는 모든 기간에 동일 가중치, EMA는 최근 가격 중시
- **계산식**:
  ```
  n일 EMA = [어제의 EMA × (n-1) + 오늘의 가격 × 2] / (n+1)
  
  예시: 5일 EMA = [어제의 EMA × 4 + 오늘의 가격 × 2] / 6
  ```
- **장점**: 가격 변화에 더 빠르게 반응, 최근 추세 민감 반영

---

**2. MACD선 (MACD Line)**

- **계산**: MACD = 12일 EMA - 26일 EMA
- **역할**: 단기와 장기 추세의 괄리 정도 표시
- **해석**: 
  - 0선 위: 단기 상승 추세
  - 0선 아래: 단기 하락 추세
  - 0선 교차: 추세 전환 신호

---

**3. 시그널선 (Signal Line)**

- **계산**: 시그널 = MACD의 9일 EMA
- **목적**: MACD의 추세를 파악하기 위한 보조선
- **활용**: MACD선과 시그널선의 교차 지점 포착
  - **골든 크로스**: MACD선이 시그널선을 아래→위 돌파 → 매수 신호
  - **데드 크로스**: MACD선이 시그널선을 위→아래 돌파 → 매도 신호

---

**4. 히스토그램 (Histogram)**

- **계산**: 히스토그램 = MACD - 시그널
- **표현**: 막대 그래프로 시각화 (양수/음수 구분)
- **역할**: MACD의 방향성을 예측하는 데 도움
- **해석**:
  - **히스토그램 > 0**: MACD가 시그널 위 (상승 모멘텀)
  - **히스토그램 < 0**: MACD가 시그널 아래 (하락 모멘텀)
  - **히스토그램 확대**: MACD와 시그널 간격 확대 (추세 강화)
  - **히스토그램 축소**: MACD와 시그널 간격 축소 (추세 약화, 교차 임박)

---

**MACD 3요소 조합 활용**
- **MACD선**: 주된 추세 방향 판단
- **시그널선**: 매매 신호 발생 포인트
- **히스토그램**: 추세 강도와 변화 조짐 조기 감지
- 세 요소를 복합적으로 분석하여 더 정확한 매매 판단

### 3.3 MACD 신호 해석

**기본 매매 신호**

**1. MACD선과 시그널선 교차 (주요 신호)**

| 교차 패턴 | 신호 | 의미 | 전략 |
|----------|------|------|------|
| MACD ↑ 시그널 | 골든 크로스 | 상승 모멘텀 시작 | 매수 신호 |
| MACD ↓ 시그널 | 데드 크로스 | 하락 모멘텀 시작 | 매도 신호 |

**2. 0선 교차 (추세 확인)**

| MACD 위치 | 의미 | 해석 |
|-------------|------|------|
| MACD > 0 | 단기선 > 장기선 | 상승 구간 |
| MACD < 0 | 단기선 < 장기선 | 하락 구간 |
| MACD = 0 | 단기선 = 장기선 | 추세 전환점 |

**3. 히스토그램 분석 (모멘텀 강도)**

- **히스토그램 확대 (막대 길이 증가)**
  - MACD와 시그널 간 거리 확대
  - 현재 추세 강화 신호
  - 기존 포지션 유지 또는 추가 진입

- **히스토그램 축소 (막대 길이 감소)**
  - MACD와 시그널 간 거리 축소
  - 추세 약화 또는 교차 임박 신호
  - 포지션 정리 또는 경계 태세

- **히스토그램 0선 교차**
  - MACD와 시그널 교차 지점
  - 기준 매매 신호 발생

---

**복합 신호 해석**

**강력한 상승 신호**
1. MACD 골든크로스 발생 (MACD ↑ 시그널)
2. MACD가 0선 위로 상승
3. 히스토그램 양수로 전환 후 확대

**강력한 하락 신호**
1. MACD 데드크로스 발생 (MACD ↓ 시그널)
2. MACD가 0선 아래로 하락
3. 히스토그램 음수로 전환 후 확대

---

**실전 활용 포인트**

| 상황 | MACD선 | 시그널선 | 히스토그램 | 해석 |
|------|---------|-----------|------------|------|
| 강세 확인 | 상승 | 상승 | 양수 확대 | 적극적 매수 |
| 약세 확인 | 하락 | 하락 | 음수 확대 | 적극적 매도 |
| 상승 전환 | 상승 | 횡보/상승 | 0 교차 후 양수 | 매수 진입 |
| 하락 전환 | 하락 | 횡보/하락 | 0 교차 후 음수 | 매도 진입 |
| 모멘텀 약화 | 횡보 | 횡보 | 0선 근처 | 관망 권장 |

**주의사항**
- MACD는 추세 추종 지표로 횡보장에서는 헛신호 다발
- 단독 사용보다는 이동평균선, 거래량 등과 병행 활용
- 0선 교차와 신호선 교차를 모두 확인하여 신뢰도 향상


---

## 4. MACD 대순환 분석 및 대응법

### 4.1 MACD 대순환의 개념

**MACD와 이동평균선 교차의 관계**
- MACD는 두 EMA 사이의 간격을 수치화한 지표
- **골든 크로스**: 두 EMA의 간격이 음수에서 0으로 수렴 (단기선이 장기선을 아래→위 돌파)
- **데드 크로스**: 두 EMA의 간격이 양수에서 0으로 수렴 (단기선이 장기선을 위→아래 돌파)
- MACD의 0선 교차 = 이동평균선의 교차 지점

**대순환 MACD의 목적**
- 이동평균선 대순환 6개 스테이지를 MACD로 파악
- 3개의 MACD 지표로 스테이지 전환 시점을 수치적으로 포착
- 시각적 분석보다 명확한 수치 기반 판단 가능
- 자동 매매 시스템 구현에 유리

**핵심 원리**
- MACD가 0선을 교차하는 순간 = 해당 이동평균선 교차 발생
- 3개의 MACD(5-20, 5-40, 20-40)로 3개 이동평균선의 모든 교차 관계 포착
- 각 MACD의 0선 교차로 스테이지 전환 예측

### 4.2 MACD 대순환 단계

**대순환 MACD 구성 요소**

3개의 MACD 지표를 사용하여 5일, 20일, 40일 EMA의 모든 관계를 포착:

| MACD 종류 | 매개변수 | 계산 | 의미 |
|-----------|---------|------|------|
| **MACD(상)** | 5 \| 20 \| 9 | 5일 EMA - 20일 EMA | 단기-중기 관계 |
| **MACD(중)** | 5 \| 40 \| 9 | 5일 EMA - 40일 EMA | 단기-장기 관계 |
| **MACD(하)** | 20 \| 40 \| 9 | 20일 EMA - 40일 EMA | 중기-장기 관계 |

- **매개변수 해석**: 첫 번째/두 번째 = EMA 기간, 세 번째 = 시그널 계산 기간(9일)
- **5, 20, 40**: 각각 단기선, 중기선, 장기선에 해당
- **9**: 모든 MACD의 시그널선 계산용 매개변수

---

**MACD 대순환 관계도**

MACD(상·중·하)의 0선 교차로 스테이지 전환 예측:

**하락 국면 진입 신호 (양수 → 0)**

| MACD | 0선 교차 | 이동평균선 교차 | 스테이지 전환 |
|------|----------|----------------|-------------|
| **MACD(상)** | + → 0 | 단기선이 중기선을 위→아래 데드크로스 | **제2스테이지** 예측 |
| **MACD(중)** | + → 0 | 단기선이 장기선을 위→아래 데드크로스 | **제3스테이지** 예측 |
| **MACD(하)** | + → 0 | 중기선이 장기선을 위→아래 데드크로스 | **제4스테이지** 예측 |

**상승 국면 진입 신호 (음수 → 0)**

| MACD | 0선 교차 | 이동평균선 교차 | 스테이지 전환 |
|------|----------|----------------|-------------|
| **MACD(상)** | - → 0 | 단기선이 중기선을 아래→위 골든크로스 | **제5스테이지** 예측 |
| **MACD(중)** | - → 0 | 단기선이 장기선을 아래→위 골든크로스 | **제6스테이지** 예측 |
| **MACD(하)** | - → 0 | 중기선이 장기선을 아래→위 골든크로스 | **제1스테이지** 예측 |

---

**MACD 대순환 순환 구조**

```
제1스테이지 (안정 상승)
    ↓ MACD(상) + → 0
제2스테이지 (하락 변화기1)
    ↓ MACD(중) + → 0
제3스테이지 (하락 변화기2)
    ↓ MACD(하) + → 0
제4스테이지 (안정 하락)
    ↓ MACD(상) - → 0
제5스테이지 (상승 변화기1)
    ↓ MACD(중) - → 0
제6스테이지 (상승 변화기2)
    ↓ MACD(하) - → 0
제1스테이지로 회귀
```

---

**주요 포인트**

1. **MACD 값의 의미**
   - **양수**: 첫 번째 EMA > 두 번째 EMA (단기선이 장기선 위)
   - **음수**: 첫 번째 EMA < 두 번째 EMA (단기선이 장기선 아래)
   - **0**: 두 EMA가 교차하는 지점

2. **스테이지 전환 예측**
   - MACD(상): 제2스테이지 또는 제5스테이지 진입
   - MACD(중): 제3스테이지 또는 제6스테이지 진입
   - MACD(하): 제4스테이지 또는 제1스테이지 진입

3. **MACD로 보는 대순환의 장점**
   - 수치적 판단 가능 (0선 교차 시점 명확)
   - 시각적 확인 불필요
   - 자동화 시스템 구현 용이
   - 3개 MACD로 6개 스테이지 모두 추적 가능

### 4.3 MACD 기반 매매 전략

**매수 타이밍**

**1. 통상 매수 (안정적 진입)**
- **조건**:
  - 제6스테이지 진입 (MACD(중) - → 0 교차)
  - 3개 MACD 모두 우상향
- **의미**: 상승 추세 확정, 가장 안전한 매수 시점
- **전략**: 기본 포지션 진입

**2. 조기 매수 (공격적 진입)**
- **조건**:
  - 제5스테이지 진입 (MACD(상) - → 0 교차)
  - 3개 MACD 모두 우상향
- **의미**: 상승 전환 초기 단계, 빠른 진입
- **전략**: 조기 진입으로 더 큰 수익 기회 포착
- **주의**: 변화기로 불확실성 존재, 리스크 관리 필수

---

**매도 타이밍**

**1. 통상 매도 (안정적 청산)**
- **조건**:
  - 제3스테이지 진입 (MACD(중) + → 0 교차)
  - 3개 MACD 모두 우하향
- **의미**: 하락 추세 확정, 가장 안전한 매도 시점
- **전략**: 매수 포지션 전량 청산

**2. 조기 매도 (선제적 청산)**
- **조건**:
  - 제2스테이지 진입 (MACD(상) + → 0 교차)
  - 3개 MACD 모두 우하향
- **의미**: 하락 전환 초기 단계, 빠른 청산
- **전략**: 조기 청산으로 손실 최소화
- **주의**: 가짜 신호 가능성, 신중한 판단 필요

---

**매매 타이밍 비교**

| 구분 | 스테이지 | MACD 0선 교차 | 3개 MACD | 특징 |
|------|---------|--------------|---------|------|
| **통상 매수** | 제6 | MACD(중) - → 0 | 우상향 | 안정적, 확실함 |
| **조기 매수** | 제5 | MACD(상) - → 0 | 우상향 | 공격적, 높은 수익 |
| **통상 매도** | 제3 | MACD(중) + → 0 | 우하향 | 안정적, 확실함 |
| **조기 매도** | 제2 | MACD(상) + → 0 | 우하향 | 선제적, 손실 최소화 |

---

**청산 (이익실현 & 손절) 판단**

MACD 히스토그램과 MACD선의 피크아웃을 활용한 3단계 청산 전략:

**1단계: 히스토그램 피크아웃 - 경계 태세**
- **현상**: 히스토그램이 최고/최저점을 찍고 방향 전환
  - 상승 중: 히스토그램 확대 멈추고 축소 시작
  - 하락 중: 히스토그램 확대(음수) 멈추고 축소 시작
- **의미**: 추세 모멘텀 약화 조짐, 교차 임박
- **전략**: 청산 검토 시작, 경계 태세 진입
- **액션**: 포지션 유지 (100%), 하나 면밀히 관찰

**2단계: MACD선 피크아웃 - 부분 청산**
- **현상**: MACD선이 최고/최저점을 찍고 방향 전환
  - 상승 중: MACD선 상승 멈추고 하락 전환
  - 하락 중: MACD선 하락 멈추고 상승 전환
- **의미**: 추세 약화 확실, 교차 가능성 증가
- **전략**: **포지션의 절반 청산**
- **액션**: 50% 이익실현, 나머지 50% 유지하며 관찰

**3단계: MACD와 시그널 교차 - 전량 청산**
- **현상**: MACD선과 시그널선이 교차
  - 상승 중: 데드크로스 발생 (MACD선이 시그널선을 위→아래 돌파)
  - 하락 중: 골든크로스 발생 (MACD선이 시그널선을 아래→위 돌파)
- **의미**: 추세 전환 확정
- **전략**: **나머지 포지션 전량 청산**
- **액션**: 100% 청산 완료, 반대 포지션 준비

---

**청산 전략 흐름도**

```
포지션 보유 (100%)
    ↓
히스토그램 피크아웃 발생
    ↓ (경계 태세)
포지션 유지 (100%) + 면밀히 관찰
    ↓
MACD선 피크아웃 발생
    ↓ (부분 청산)
포지션 50% 청산 (50% 남음)
    ↓
MACD-시그널 교차 발생
    ↓ (전량 청산)
포지션 100% 청산 완료
```

---

**MACD 기반 매매 핵심 원칙**

1. **진입 원칙**
   - 스테이지와 3개 MACD 방향 모두 확인
   - 조기 진입은 더 큰 수익이지만 더 큰 리스크
   - 통상 진입이 더 안전하지만 수익 감소

2. **청산 원칙**
   - 3단계 청산 전략 활용
   - 히스토그램 → MACD선 → 교차 순서로 단계적 대응
   - 급격한 전량 청산보다 분할 청산으로 리스크 관리

3. **리스크 관리**
   - 조기 매매는 손절 라인 필수 설정
   - 히스토그램 피크아웃을 경고로 활용
   - 단일 신호가 아닌 복합 신호로 판단

4. **실전 포인트**
   - 3개 MACD가 모두 같은 방향일 때 신뢰도 최고
   - 히스토그램 피크아웃은 가장 빠른 경고 신호
   - 시그널 교차는 최종 확정 신호
   - 변화기(제2·3·5·6스테이지)에서는 보수적 대응

---

## 5. 자금 관리와 리스크 관리

### 5.1 포지션 사이징

**1유닛(Unit) 개념 (터틀 트레이딩)**

유닛은 포지션의 기본 단위로, 변동성을 기반으로 한 리스크 조절 방식입니다.

**유닛 계산 공식**
```
1유닛 = (계좌 잔고 × 1%) / ATR
```

**구성 요소**
- **계좌 잔고**: 현재 가용 가능한 총 자금
- **1% 리스크**: 한 번의 거래에서 감수할 수 있는 최대 손실
- **ATR (Average True Range)**: N일 평균 변동폭 (통상 20일)

**유닛의 의미**
- 변동성이 클수록 포지션 축소 (리스크 감소)
- 변동성이 작을수록 포지션 확대 (기회 확대)
- 모든 종목에 동일한 리스크 비율 적용

**실전 예시**
```
계좌 잔고: 1억원
종목 A의 ATR: 5,000원
종목 B의 ATR: 10,000원

종목 A의 1유닛 = (1억 × 1%) / 5,000 = 200주
종목 B의 1유닛 = (1억 × 1%) / 10,000 = 100주

→ 변동성이 큰 종목은 더 적은 주수 보유
```

**포지션 사이징 원칙**
1. 기본 진입: 1유닛으로 시작
2. 추가 진입: 추세 확인 시 1유닛씩 추가 (피라미딩)
3. 최대 포지션: 리스크 관리 원칙에 따라 제한
4. 손실 발생 시: 유닛 수를 줄여 리스크 감소

**ATR (Average True Range) 계산**
- True Range = Max(고가 - 저가, |고가 - 전일종가|, |저가 - 전일종가|)
- ATR = N일간 True Range의 평균 (통상 N=20)
- 변동성이 클수록 ATR 값이 커짐

**핵심 포인트**
- 고정 금액이 아닌 변동성 기반 포지션 결정
- 모든 종목에 동일한 리스크 비율 적용
- 시장 변동성에 따라 자동 조절
- 1번의 거래로 계좌의 1%만 리스크에 노출

### 5.2 손절과 익절 전략

**손절(Stop Loss) 전략**

**1. 추세 기반 손절**
- **원칙**: 추세를 기준으로 손절 포인트 라인을 설정
- **실행**: 추세가 전환되었다면 빠르게 손절
- **기준점**:
  - 매수 포지션: 이동평균선 데드크로스 발생 시점
  - 매도 포지션: 이동평균선 골든크로스 발생 시점
  - MACD 기준: MACD와 시그널선 교차 발생
- **의미**: 추세 전환 확인 시 즉시 손실 확정, 추가 손실 방지
- **예시**:
  ```
  매수 포지션 보유 중
  → 단기선이 중기선을 데드크로스 (제2스테이지 진입)
  → 즉시 손절 실행
  ```

**2. 변동성 기반 손절 (2ATR 규칙)**
- **원칙**: 추세를 둘러싼 노이즈의 폭이 **2ATR을 넘어서는 순간** 빠르게 손절
- **ATR (Average True Range)**: N일 평균 변동폭 (통상 20일)
- **계산**:
  ```
  매수 손절 라인 = 진입가 - (2 × ATR)
  매도 손절 라인 = 진입가 + (2 × ATR)
  ```
- **의미**: 정상적인 변동성을 초과하는 손실 발생 시 즐시 종료
- **장점**: 
  - 시장 변동성에 따라 자동 조정
  - 객관적 기준 제공
  - 감정적 판단 배제
- **예시**:
  ```
  종목 A 매수가: 50,000원
  ATR: 2,000원
  손절 라인 = 50,000 - (2 × 2,000) = 46,000원
  → 46,000원 도달 시 자동 손절
  ```

---

**손절 실행 원칙**

1. **두 가지 기준 병행**
   - 추세 기반 손절과 2ATR 손절을 동시 설정
   - 먼저 도달하는 지점에서 실행

2. **예약 주문 활용**
   - 손절 라인은 항상 예약 주문으로 설정
   - 감정적 판단 배제, 기계적 실행

3. **손절 후 대응**
   - 손절 후 재진입은 새로운 신호 발생 시만 고려
   - 즐각적인 복수 매매 금지

4. **손절 조정 금지**
   - 한 번 설정한 손절 라인은 불리한 방향으로 조정 금지
   - 유리한 방향으로만 조정 가능 (트레일링 스톱)

---

**익절(Take Profit) 전략**

**분할 익절 전략 (MACD 기반)**

MACD 3단계 청산 전략 활용:

1. **히스토그램 피크아웃**: 경계 태세 (0% 청산)
2. **MACD선 피크아웃**: 50% 부분 익실
3. **MACD-시그널 교차**: 100% 전량 청산

**추가 익절 기법**

**트레일링 스톱 (Trailing Stop)**
- **개념**: 가격이 유리한 방향으로 움직일 때 손절 라인도 함께 이동
- **설정**: 최고가/최저가에서 2ATR 하락/상승 지점
- **이점**: 수익 보호하면서 추세 최대한 활용
- **예시**:
  ```
  매수가: 50,000원
  현재가: 60,000원 (신고가)
  ATR: 2,000원
  트레일링 스톱 = 60,000 - (2 × 2,000) = 56,000원
  → 56,000원까지 하락 시 자동 매도
  ```

**목표 수익률 기반**
- **R리워드 개념**: 리스크대비수익 (Risk-Reward Ratio)
- **기본 목표**: 1R 손실 대비 2-3R 수익
- **예시**: 손절 2% 설정 시, 목표 수익 4-6%
- **적용**: 보수적인 종목에서 활용

---

**실전 원칙**

| 원칙 | 내용 |
|------|------|
| **손절** | 엄격하게, 예외 없음 |
| **익절** | 유연하게, 상황에 따라 |
| **손실** | 작게, 빠르게 |
| **수익** | 크게, 길게 |
| **변화기** | 보수적 익절 |
| **안정기** | 공격적 보유 |

**핵심 포인트**
- 손절은 리스크 관리의 핵심, 반드시 지키기
- 익절은 수익 최대화의 수단, 유연하게 운영
- 2ATR 규칙은 객관적 기준 제공
- 변화기(제2·3·5·6스테이지)에서는 보수적 대응
- 안정기(제1·4스테이지)에서는 트레일링 스톱 활용

### 5.3 리스크 관리 원칙

**유닛 기반 포지션 제한**

리스크 분산을 위한 4단계 포지션 제한 규칙:

**1. 동일 종목 제한: 최대 4유닛**
- **규칙**: 한 종목에 최대 4유닛까지만 포지션 보유
- **의미**: 단일 종목 집중 리스크 방지
- **예시**: 삼성전자 4유닛 초과 금지
- **적용**: 1유닛씩 점진적 추가, 최대 4회 분할 매수

**2. 상관관계 높은 종목: 최대 6유닛**
- **규칙**: 상관계수 0.7 이상 종목들의 합은 6유닛 제한
- **예시**: 반도체 섹터 (SK하이닉스 3유닛 + 삼성전자 3유닛 = 6유닛)
- **의미**: 비슷한 업종/섹터 리스크 분산
- **확인**: 동일 업종, 공급망 관계, 사업 모델 유사성 검토

**3. 상관관계 낮은 종목: 최대 10유닛**
- **규칙**: 상관계수 0.3 미만 종목들의 합은 10유닛 제한
- **예시**: 바이오 4유닛 + 자동차 3유닛 + 운송 3유닛 = 10유닛
- **의미**: 다른 업종 분산으로 안정적 포트폴리오
- **이점**: 특정 섹터 하락 시도 전체 자산 보호

**4. 매수/매도 포지션 합계: 최대 12유닛**
- **규칙**: 매수 포지션과 매도(공매도) 포지션을 합쳐서 12유닛 초과 금지
- **예시**: 매수 8유닛 + 매도 4유닛 = 12유닛
- **의미**: 전체 레버리지 통제, 계좌 변동성 제한
- **주의**: 양방향 포지션은 시장 방향 불확실 시만 활용

---

**리스크 관리 표**

| 구분 | 제한 | 예시 |
|------|------|------|
| **동일 종목** | 4유닛 | 삼성전자 4유닛 |
| **상관 높음** | 6유닛 | 반도체 섹터 6유닛 |
| **상관 낮음** | 10유닛 | 다양한 업종 10유닛 |
| **전체 포지션** | 12유닛 | 매수+매도 12유닛 |

---

## 핵심 매매 전략 요약

> 본 섹션은 자동 매매 시스템 구현을 위한 핵심 전략을 요약합니다.

---

**1. 기본 구성 요소**

```
이동평균선: 5일선(단기), 20일선(중기), 40일선(장기)
MACD 3종: MACD(상) 5|20|9, MACD(중) 5|40|9, MACD(하) 20|40|9
```

---

**2. 6개 스테이지 판단 로직**

| 스테이지 | 이동평균선 배열 | MACD 신호 | 시장 국면 |
|---------|--------------|---------|----------|
| 제1 | 단기>중기>장기 | MACD(하) -→0 | 안정 상승기 |
| 제2 | 중기>단기>장기 | MACD(상) +→0 | 하락 변화기1 |
| 제3 | 중기>장기>단기 | MACD(중) +→0 | 하락 변화기2 |
| 제4 | 장기>중기>단기 | MACD(하) +→0 | 안정 하락기 |
| 제5 | 장기>단기>중기 | MACD(상) -→0 | 상승 변화기1 |
| 제6 | 단기>장기>중기 | MACD(중) -→0 | 상승 변화기2 |

---

**3. 매매 신호 생성 규칙**

**매수 신호**
- **통상 매수**: 제6스테이지 + 3개 MACD 모두 우상향
- **조기 매수**: 제5스테이지 + 3개 MACD 모두 우상향

**매도 신호**
- **통상 매도**: 제3스테이지 + 3개 MACD 모두 우하향
- **조기 매도**: 제2스테이지 + 3개 MACD 모두 우하향

**청산 신호 (3단계)**
1. 히스토그램 피크아웃 → 경계 태세
2. MACD선 피크아웃 → 50% 청산
3. MACD-시그널 교차 → 100% 청산

---

**4. 포지션 관리**

```python
# 포지션 사이징
1유닛 = (계좌잔고 × 1%) / ATR

# 손절 라인
매수_손절 = min(진입가 - 2×ATR, 데드크로스_가격)
매도_손절 = max(진입가 + 2×ATR, 골든크로스_가격)

# 포지션 제한
동일종목_최대 = 4유닛
상관높은종목_최대 = 6유닛
상관낮은종목_최대 = 10유닛
전체포지션_최대 = 12유닛
```

---



# 이동평균선 기반 주식 자동매매 시스템

> 이동평균선 투자법과 MACD 대순환 분석을 활용한 체계적인 주식 자동매매 시스템

## 📌 프로젝트 개요

본 프로젝트는 "이동평균선 투자법" 책의 핵심 전략을 기반으로 한 자동매매 시스템입니다. 
3개의 이동평균선과 MACD 지표를 활용하여 시장의 6단계 순환 구조를 분석하고, 
체계적인 리스크 관리를 통해 안정적인 수익을 추구합니다.

## 🎯 핵심 전략

### 기술적 지표
- **이동평균선**: 5일선(단기), 20일선(중기), 40일선(장기)
- **MACD 3종 조합**:
  - MACD(상): 5|20|9 - 단기-중기 관계
  - MACD(중): 5|40|9 - 단기-장기 관계
  - MACD(하): 20|40|9 - 중기-장기 관계

### 대순환 분석 (6단계 스테이지)

| 스테이지 | 시장 국면 | 전략 |
|---------|----------|------|
| 제1 | 안정 상승기 | 공격적 매수 |
| 제2 | 하락 변화기1 | 포지션 유지 판단 |
| 제3 | 하락 변화기2 | 매수 청산 & 매도 진입 |
| 제4 | 안정 하락기 | 공격적 매도 |
| 제5 | 상승 변화기1 | 포지션 유지 판단 |
| 제6 | 상승 변화기2 | 매도 청산 & 매수 진입 |

### 매매 신호

**진입 신호**
- **통상 매수**: 제6스테이지 + 3개 MACD 모두 우상향
- **조기 매수**: 제5스테이지 + 3개 MACD 모두 우상향
- **통상 매도**: 제3스테이지 + 3개 MACD 모두 우하향
- **조기 매도**: 제2스테이지 + 3개 MACD 모두 우하향

**청산 신호 (3단계)**
1. 히스토그램 피크아웃 → 경계 태세 (0% 청산)
2. MACD선 피크아웃 → 50% 청산
3. MACD-시그널 교차 → 100% 청산

## 🛡️ 리스크 관리

### 포지션 사이징
```
1유닛 = (계좌잔고 × 1%) / ATR
```

### 손절 규칙
- **추세 기반**: 데드크로스/골든크로스 발생 시
- **변동성 기반**: 진입가 ± 2ATR

### 포지션 제한
- 동일 종목: 최대 4유닛
- 상관관계 높은 종목: 최대 6유닛
- 상관관계 낮은 종목: 최대 10유닛
- 전체 포지션: 최대 12유닛

## 📁 프로젝트 구조

```
Hanlyang_Stock_MA/
├── README.md                                    # 프로젝트 소개
├── Moving_Average_Investment_Strategy_Summary.md # 전략 상세 문서
├── .gitignore                                   # Git 제외 설정
├── pyproject.toml                               # 프로젝트 설정
│
├── src/                                         # 소스 코드
│   ├── strategy/                                # 매매 전략 로직
│   │   └── __init__.py
│   ├── backtest/                                # 백테스팅 엔진
│   │   └── __init__.py
│   ├── analysis/                                # 시장 분석
│   │   ├── __init__.py
│   │   └── technical/                           # 기술적 분석 전략
│   │       └── __init__.py                      # (이동평균선, RSI 등)
│   ├── config/                                  # 설정 관리
│   │   └── __init__.py                          # (YAML 기반)
│   └── utils/                                   # 유틸리티
│       ├── __init__.py
│       ├── koreainvestment/                     # 한국투자증권 API
│       │   └── __init__.py
│       └── slack/                               # Slack 알림
│           └── __init__.py
│
├── data/                                        # JSON 데이터 저장소
│   └── README.md
│
├── history/                                     # 개발 이력 관리
│   ├── README.md
│   └── 2025-10-14_project_setup.md
│
└── log/                                         # 실행 로그
    └── README.md
```

### 구조 설명

#### **src/** - 소스 코드
- **strategy/**: 매매 전략 로직 구현
- **backtest/**: 백테스팅 엔진 및 성과 분석
- **analysis/technical/**: 기술적 분석 전략 모듈 (확장 가능한 구조)
- **config/**: YAML 기반 설정 관리
- **utils/**: 유틸리티 기능
  - **koreainvestment/**: 한국투자증권 API 연동
  - **slack/**: Slack 알림 기능
  - 파일 입출력 등 공통 기능

#### **data/** - 데이터 저장소
- JSON 파일 형태로 데이터 관리 (DB 미사용)
- 주가, 지표, 신호, 포지션 등

#### **history/** - 개발 이력
- 날짜별 개발 기록 (마크다운)
- 이슈 및 해결 방법 기록

#### **log/** - 실행 로그
- 백테스팅 결과 로그
- Crontab 실행 로그

## 🚀 시작하기

### 필요 환경
- Python 3.8 이상
- 필수 라이브러리: pandas, numpy, TA-Lib (예정)

### 설치 방법
```bash
# 저장소 클론
git clone https://github.com/hlyang7036/Hanlyang_Stock_MA.git
cd Hanlyang_Stock_MA

# uv 설치 (미설치 시)
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh
# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# 가상환경 생성 및 활성화
uv venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 의존성 설치
uv pip install
```

## 📊 주요 기능 (예정)

- [ ] 실시간 주가 데이터 수집
- [ ] 이동평균선 및 MACD 계산
- [ ] 6단계 스테이지 자동 판단
- [ ] 매매 신호 생성 및 알림
- [ ] 백테스팅 시스템
- [ ] 포지션 관리 및 리스크 통제
- [ ] 실거래 API 연동
- [ ] 성과 분석 및 리포팅

## 📖 문서

전략에 대한 상세한 설명은 [전략 문서](./Moving_Average_Investment_Strategy_Summary.md)를 참고하세요.

## ⚠️ 주의사항

- 본 시스템은 교육 및 연구 목적으로 개발되었습니다.
- 실제 투자 시 발생하는 손실에 대해 개발자는 책임지지 않습니다.
- 투자는 본인의 판단과 책임 하에 진행하시기 바랍니다.
- 백테스팅 결과가 실제 수익을 보장하지 않습니다.

## 📝 라이선스

MIT License

## 👨‍💻 개발자

- seunghakim

## 📚 참고 자료

- "이동평균선 투자법" (원서 기반)
- 터틀 트레이딩 기법
- 그랜빌의 법칙

---

**개발 상태**: 🚧 초기 개발 단계
